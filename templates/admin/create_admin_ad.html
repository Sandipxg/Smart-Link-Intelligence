{% extends "admin/base.html" %}

{% block title %}Create Advertisement{% endblock %}
{% block page_title %}Create Advertisement{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-plus"></i> Create New Advertisement
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data" id="adForm">

                    <!-- Ad Type Selection -->
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fas fa-palette"></i> Advertisement Type
                        </label>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="ad_type" id="custom_ad"
                                        value="custom" checked>
                                    <label class="form-check-label" for="custom_ad">
                                        <i class="fas fa-paint-brush"></i> Custom Design
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="ad_type" id="image_ad"
                                        value="image">
                                    <label class="form-check-label" for="image_ad">
                                        <i class="fas fa-image"></i> Image Upload
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Basic Information -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="title" class="form-label">
                                    <i class="fas fa-heading"></i> Ad Title *
                                </label>
                                <input type="text" class="form-control" id="title" name="title" required
                                    maxlength="100">
                                <div class="form-text">Maximum 100 characters</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="grid_position" class="form-label">
                                    <i class="fas fa-th"></i> Grid Position *
                                </label>
                                <select class="form-select" id="grid_position" name="grid_position" required>
                                    <option value="1">Position 1 (Large - Top)</option>
                                    <option value="2">Position 2 (Small - Bottom Left)</option>
                                    <option value="3">Position 3 (Small - Bottom Right)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label">
                            <i class="fas fa-align-left"></i> Description *
                        </label>
                        <textarea class="form-control" id="description" name="description" rows="3" required
                            maxlength="200"></textarea>
                        <div class="form-text">Maximum 200 characters</div>
                    </div>

                    <!-- Call to Action -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="cta_text" class="form-label">
                                    <i class="fas fa-mouse-pointer"></i> Button Text *
                                </label>
                                <input type="text" class="form-control" id="cta_text" name="cta_text" required
                                    maxlength="50">
                                <div class="form-text">Maximum 50 characters</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="cta_url" class="form-label">
                                    <i class="fas fa-link"></i> Target URL *
                                </label>
                                <input type="url" class="form-control" id="cta_url" name="cta_url" required>
                                <div class="form-text">Must start with http:// or https://</div>
                            </div>
                        </div>
                    </div>

                    <!-- Custom Ad Design Options -->
                    <div id="customAdOptions">
                        <hr>
                        <h6><i class="fas fa-palette"></i> Custom Design Options</h6>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="icon" class="form-label">
                                        <i class="fas fa-smile"></i> Icon/Emoji
                                    </label>
                                    <input type="text" class="form-control" id="icon" name="icon" value="ðŸš€"
                                        maxlength="10">
                                    <div class="form-text">Emoji or short text</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="background_color" class="form-label">
                                        <i class="fas fa-fill-drip"></i> Background Color
                                    </label>
                                    <input type="color" class="form-control form-control-color" id="background_color"
                                        name="background_color" value="#667eea">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="text_color" class="form-label">
                                        <i class="fas fa-font"></i> Text Color
                                    </label>
                                    <input type="color" class="form-control form-control-color" id="text_color"
                                        name="text_color" value="#ffffff">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Image Upload Options -->
                    <div id="imageAdOptions" style="display: none;">
                        <hr>
                        <h6><i class="fas fa-image"></i> Image Upload</h6>

                        <div class="mb-3">
                            <label for="ad_image" class="form-label">
                                <i class="fas fa-upload"></i> Upload Image
                            </label>
                            <input type="file" class="form-control" id="ad_image" name="ad_image" accept="image/*">
                            <div class="form-text">Supported formats: PNG, JPG, JPEG, GIF, WEBP. Max size: 16MB</div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <hr>
                    <h6><i class="fas fa-eye"></i> Live Preview</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card" id="adPreview">
                                <div class="card-body text-center" id="previewContent"
                                    style="background: #667eea; color: #ffffff; min-height: 150px; display: flex; align-items: center; justify-content: center; flex-direction: column;">
                                    <div style="font-size: 2rem;" id="previewIcon">ðŸš€</div>
                                    <h6 class="mt-2" id="previewTitle">Your Ad Title</h6>
                                    <p class="small" id="previewDescription">Your ad description will appear here</p>
                                    <button type="button" class="btn btn-light btn-sm" id="previewButton">Click
                                        Here</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle"></i> Preview Notes</h6>
                                <ul class="mb-0 small">
                                    <li>Position 1: Large ad (shown above)</li>
                                    <li>Position 2 & 3: Smaller versions</li>
                                    <li>Colors and styling will be applied</li>
                                    <li>Image ads will replace the custom design</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <hr>
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('admin.ads') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-admin">
                            <i class="fas fa-plus"></i> Create Advertisement
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Toggle between custom and image ad options
    document.querySelectorAll('input[name="ad_type"]').forEach(radio => {
        radio.addEventListener('change', function () {
            const customOptions = document.getElementById('customAdOptions');
            const imageOptions = document.getElementById('imageAdOptions');

            if (this.value === 'custom') {
                customOptions.style.display = 'block';
                imageOptions.style.display = 'none';
                document.getElementById('ad_image').required = false;
            } else {
                customOptions.style.display = 'none';
                imageOptions.style.display = 'block';
                document.getElementById('ad_image').required = true;
            }
            updatePreview();
        });
    });

    // Live preview updates
    function updatePreview() {
        const title = document.getElementById('title').value || 'Your Ad Title';
        const description = document.getElementById('description').value || 'Your ad description will appear here';
        const icon = document.getElementById('icon').value || 'ðŸš€';
        const backgroundColor = document.getElementById('background_color').value;
        const textColor = document.getElementById('text_color').value;
        const ctaText = document.getElementById('cta_text').value || 'Click Here';

        const previewContent = document.getElementById('previewContent');
        const previewIcon = document.getElementById('previewIcon');
        const previewTitle = document.getElementById('previewTitle');
        const previewDescription = document.getElementById('previewDescription');
        const previewButton = document.getElementById('previewButton');

        // Update content
        previewIcon.textContent = icon;
        previewTitle.textContent = title;
        previewDescription.textContent = description;
        previewButton.textContent = ctaText;

        // Update colors
        previewContent.style.background = backgroundColor;
        previewContent.style.color = textColor;
    }

    // Add event listeners for live preview
    document.getElementById('title').addEventListener('input', updatePreview);
    document.getElementById('description').addEventListener('input', updatePreview);
    document.getElementById('icon').addEventListener('input', updatePreview);
    document.getElementById('background_color').addEventListener('input', updatePreview);
    document.getElementById('text_color').addEventListener('input', updatePreview);
    document.getElementById('cta_text').addEventListener('input', updatePreview);

    // Form validation
    document.getElementById('adForm').addEventListener('submit', function (e) {
        const adType = document.querySelector('input[name="ad_type"]:checked').value;
        const imageFile = document.getElementById('ad_image').files[0];

        if (adType === 'image' && !imageFile) {
            e.preventDefault();
            alert('Please select an image file for image-type advertisements.');
            return false;
        }

        // Validate URL
        const url = document.getElementById('cta_url').value;
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
            e.preventDefault();
            alert('Please enter a valid URL starting with http:// or https://');
            return false;
        }
    });

    // Character counters
    function addCharacterCounter(inputId, maxLength) {
        const input = document.getElementById(inputId);
        const helpText = input.nextElementSibling;

        input.addEventListener('input', function () {
            const remaining = maxLength - this.value.length;
            helpText.textContent = `${remaining} characters remaining`;

            if (remaining < 0) {
                helpText.classList.add('text-danger');
            } else {
                helpText.classList.remove('text-danger');
            }
        });
    }

    // Add character counters
    addCharacterCounter('title', 100);
    addCharacterCounter('description', 200);
    addCharacterCounter('cta_text', 50);
</script>

{% block extra_head %}
<link href="{{ url_for('static', filename='css/admin/admin_create_admin_ad.css') }}" rel="stylesheet">
{% endblock %}
{% endblock %}